<!DOCTYPE html>
<html lang="nl">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tag Diff Checker</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background: #f6f7fb;
			margin: 2rem;
		}
		h1 { text-align: center; }
		textarea {
			width: 100%;
			height: 150px;
			font-family: monospace;
			font-size: 14px;
			margin-bottom: 1rem;
		}
		button {
			display: block;
			margin: 1rem auto;
			padding: 10px 20px;
			font-size: 16px;
			cursor: pointer;
			border: none;
			border-radius: 6px;
			background-color: #4a90e2;
			color: white;
		}
		.panel {
			background: white;
			padding: 1rem;
			border-radius: 8px;
			box-shadow: 0 0 5px rgba(0,0,0,0.1);
			white-space: pre-wrap;
			font-family: monospace;
		}
		.extra { background-color: #ffb3b3; }
		.missing { background-color: #fff3b0; }
		.summary code { background: #eef; padding: 0 .25rem; border-radius: 4px; }
	</style>
</head>
<body>

	<h1>Tag Diff Checker</h1>

	<h3>Originele tekst:</h3>
	<textarea id="original"></textarea>

	<h3>Vertaalde tekst:</h3>
	<textarea id="translated"></textarea>

	<button onclick="compareTags()">Vergelijken</button>

	<h3>Resultaat</h3>
	<div id="result" class="panel"></div>

	<script>
		function escapeHtml(str) {
			return str
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}

		function safeRegExpLiteral(text) {
			return text.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
		}

		function countTags(arr) {
			const m = new Map();
			for (const t of arr) m.set(t, (m.get(t) || 0) + 1);
			return m;
		}

		function highlightEscaped(text, rawTag, cssClass) {
			const escapedTag = escapeHtml(rawTag);
			const re = new RegExp(safeRegExpLiteral(escapedTag), "g");
			return text.replace(re, `<span class="${cssClass}">${escapedTag}</span>`);
		}

		function compareTags() {
			const original = document.getElementById("original").value;
			const translated = document.getElementById("translated").value;
			const resultDiv = document.getElementById("result");

			const tagRegex = /<\/?\d+>/g;
			const origTags = original.match(tagRegex) || [];
			const transTags = translated.match(tagRegex) || [];

			const origCount = countTags(origTags);
			const transCount = countTags(transTags);

			let missingTags = [];
			let extraTags = [];

			for (const [tag, oCount] of origCount.entries()) {
				const tCount = transCount.get(tag) || 0;
				if (oCount > tCount) {
					for (let i = 0; i < oCount - tCount; i++) missingTags.push(tag);
				}
			}
			for (const [tag, tCount] of transCount.entries()) {
				const oCount = origCount.get(tag) || 0;
				if (tCount > oCount) {
					for (let i = 0; i < tCount - oCount; i++) extraTags.push(tag);
				}
			}

			// Escape entire texts so tags are always visible
			let escapedOriginal = escapeHtml(original);
			let escapedTranslated = escapeHtml(translated);

			// Highlight missing tags in original
			for (const tag of missingTags) {
				escapedOriginal = highlightEscaped(escapedOriginal, tag, "missing");
			}
			// Highlight extra tags in translation
			for (const tag of extraTags) {
				escapedTranslated = highlightEscaped(escapedTranslated, tag, "extra");
			}

			// Build summary
			let summaryHtml = "";
			if (missingTags.length > 0)
				summaryHtml += `ðŸŸ¨ <b>Missing tags (in vertaling ontbreken):</b> ${missingTags.map(t => `<code>${escapeHtml(t)}</code>`).join(", ")}<br>`;
			if (extraTags.length > 0)
				summaryHtml += `ðŸŸ¥ <b>Extra tags (alleen in vertaling):</b> ${extraTags.map(t => `<code>${escapeHtml(t)}</code>`).join(", ")}`;
			if (missingTags.length === 0 && extraTags.length === 0)
				summaryHtml = "âœ… Alle tags komen overeen.";

			// Output
			resultDiv.innerHTML =
				`<b>Vertaalde tekst (extra tags rood):</b>\n${escapedTranslated}\n\n<hr>` +
				`<b>Originele tekst (ontbrekende tags geel):</b>\n${escapedOriginal}\n\n<hr>` +
				`<div class="summary">${summaryHtml}</div>`;
		}
	</script>

</body>
</html>
