<!DOCTYPE html>
<html lang="nl">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tag Diff Checker</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background: #f6f7fb;
			margin: 2rem;
		}
		h1 { text-align: center; }
		textarea {
			width: 100%;
			height: 150px;
			font-family: monospace;
			font-size: 14px;
			margin-bottom: 1rem;
		}
		button {
			display: block;
			margin: 1rem auto;
			padding: 10px 20px;
			font-size: 16px;
			cursor: pointer;
			border: none;
			border-radius: 6px;
			background-color: #4a90e2;
			color: white;
		}
		section { margin-top: 1rem; }
		.panel {
			background: white;
			padding: 1rem;
			border-radius: 8px;
			box-shadow: 0 0 5px rgba(0,0,0,0.1);
			white-space: pre-wrap;
			font-family: monospace;
		}
		.extra { background-color: #ffb3b3; }
		.missing { background-color: #fff3b0; }
		.summary code { background: #eef; padding: 0 .25rem; border-radius: 4px; }
	</style>
</head>
<body>

	<h1>Tag Diff Checker</h1>

	<h3>Originele tekst:</h3>
	<textarea id="original"></textarea>

	<h3>Vertaalde tekst:</h3>
	<textarea id="translated"></textarea>

	<button onclick="compareTags()">Vergelijken</button>

	<section>
		<h3>Resultaat</h3>
		<div id="result" class="panel"></div>
	</section>

	<script>
		function escapeHtml(str) {
			return str.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}

		function safeRegExpLiteral(text) {
			return text.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
		}

		function countTags(arr) {
			const m = new Map();
			for (const t of arr) m.set(t, (m.get(t) || 0) + 1);
			return m;
		}

		// Highlight maximaal 'count' keer (niet alle voorkomens)
		function highlightLimited(text, tag, count, cssClass) {
			if (count <= 0) return text;
			const re = new RegExp(safeRegExpLiteral(tag), "g");
			let remaining = count;
			return text.replace(re, (match) => {
				if (remaining > 0) {
					remaining--;
					return `<span class="${cssClass}">${match}</span>`;
				}
				return match;
			});
		}

		function compareTags() {
			const original = document.getElementById("original").value;
			const translated = document.getElementById("translated").value;
			const resultDiv = document.getElementById("result");

			// Tags als <1>, </1>, <23>, </23>
			const tagRegex = /<\/?\d+>/g;
			const origTags = original.match(tagRegex) || [];
			const transTags = translated.match(tagRegex) || [];

			const origCount = countTags(origTags);
			const transCount = countTags(transTags);

			// Bepaal ontbrekende en extra aantallen
			const missingCounts = new Map();
			const extraCounts = new Map();

			// Missing: in origineel vaker dan in vertaling
			for (const [tag, oCount] of origCount.entries()) {
				const tCount = transCount.get(tag) || 0;
				if (oCount > tCount) missingCounts.set(tag, oCount - tCount);
			}
			// Extra: in vertaling vaker dan in origineel
			for (const [tag, tCount] of transCount.entries()) {
				const oCount = origCount.get(tag) || 0;
				if (tCount > oCount) extraCounts.set(tag, tCount - oCount);
			}

			// Highlight in vertaalde tekst de extra tags (alle voorkomens markeren is okÃ©)
			let highlightedTranslated = translated;
			for (const [tag] of extraCounts.entries()) {
				const re = new RegExp(safeRegExpLiteral(tag), "g");
				highlightedTranslated = highlightedTranslated.replace(
					re,
					`<span class="extra">${tag}</span>`
				);
			}

			// Highlight in originele tekst precies zoveel voorkomens als er missen
			let highlightedOriginal = original;
			for (const [tag, diff] of missingCounts.entries()) {
				highlightedOriginal = highlightLimited(highlightedOriginal, tag, diff, "missing");
			}

			// Maak leesbare, ge-escapete lijsten (anders verdwijnen <..> in HTML)
			const missingList = [];
			for (const [tag, diff] of missingCounts.entries()) {
				for (let i = 0; i < diff; i++) missingList.push(`<code>${escapeHtml(tag)}</code>`);
			}
			const extraList = [];
			for (const [tag, diff] of extraCounts.entries()) {
				for (let i = 0; i < diff; i++) extraList.push(`<code>${escapeHtml(tag)}</code>`);
			}

			let summaryHtml = "";
			if (missingList.length > 0) {
				summaryHtml += `ðŸŸ¨ <b>Missing tags (t.o.v. vertaling) in origineel gemarkeerd:</b> ${missingList.join(", ")}<br>`;
			}
			if (extraList.length > 0) {
				summaryHtml += `ðŸŸ¥ <b>Extra tags (alleen in vertaling):</b> ${extraList.join(", ")}`;
			}
			if (missingList.length === 0 && extraList.length === 0) {
				summaryHtml = "âœ… Alle tags komen overeen.";
			}

			// Toon twee panelen + samenvatting
			resultDiv.innerHTML =
				`<b>Vertaalde tekst (extra tags rood):</b>\n` +
				`${highlightedTranslated}\n\n` +
				`<hr>` +
				`<b>Originele tekst (ontbrekende tags geel):</b>\n` +
				`${highlightedOriginal}\n\n` +
				`<hr>` +
				`<div class="summary">${summaryHtml}</div>`;
		}
	</script>

</body>
</html>
