<script>
function compareTags() {
	const original = document.getElementById("original").value;
	const translated = document.getElementById("translated").value;
	const resultDiv = document.getElementById("result");

	const tagRegex = /<\/?\d+>/g;
	const origTags = original.match(tagRegex) || [];
	const transTags = translated.match(tagRegex) || [];

	// Count how many times each tag appears
	const countTags = arr => arr.reduce((acc, t) => {
		acc[t] = (acc[t] || 0) + 1;
		return acc;
	}, {});

	const origCount = countTags(origTags);
	const transCount = countTags(transTags);

	let missing = [];
	let extra = [];

	// Find missing tags
	for (const tag in origCount) {
		const diff = (origCount[tag] || 0) - (transCount[tag] || 0);
		if (diff > 0) {
			missing.push(`${tag} (${diff}Ã—)`);
		}
	}

	// Find extra tags
	for (const tag in transCount) {
		const diff = (transCount[tag] || 0) - (origCount[tag] || 0);
		if (diff > 0) {
			extra.push(`${tag} (${diff}Ã—)`);
		}
	}

	// Highlight missing & extra tags directly in text
	let highlighted = translated;

	for (const tag in transCount) {
		const diff = (transCount[tag] || 0) - (origCount[tag] || 0);
		if (diff > 0) {
			const re = new RegExp(tag.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "g");
			highlighted = highlighted.replace(re, `<span class="extra">${tag}</span>`);
		}
	}

	for (const tag in origCount) {
		const diff = (origCount[tag] || 0) - (transCount[tag] || 0);
		if (diff > 0) {
			const re = new RegExp(tag.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "g");
			highlighted += `<span class="missing">${tag}</span>`;
		}
	}

	// Build readable summary
	let output = highlighted;
	if (missing.length > 0)
		output += `\n\nðŸŸ¨ <b>Missing tags:</b> ${missing.join(", ")}`;
	if (extra.length > 0)
		output += `\n\nðŸŸ¥ <b>Extra tags:</b> ${extra.join(", ")}`;
	if (missing.length === 0 && extra.length === 0)
		output = "âœ… All tags match!";

	resultDiv.innerHTML = output;
}
</script>
